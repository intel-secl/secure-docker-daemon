---
stages:
  - buildtest

variables:
  DOCKER_GRAPHDRIVER: secureoverlay2
  HTTPS_PROXY: "${HTTPS_PROXY}"
  HTTP_PROXY: "${HTTP_PROXY}"
  NO_PROXY: "${NO_PROXY}"
  http_proxy: "${HTTP_PROXY}"
  https_proxy: "${HTTPS_PROXY}"
  no_proxy: "${NO_PROXY}"

buildtest:
  artifacts:
    paths:
      - out/
      - docker-ce/components/engine/bundles/test-integration/test.log
      - docker-ce/components/engine/bundles/test-integration/docker.log
    expire_in: 1 week
  script:
    - "cd $CI_PROJECT_DIR"
    - "make all"
    - "make unittest"
    - "make testintegrationengine"
  stage: buildtest
  tags:
    - secdocker
